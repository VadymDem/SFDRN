version: '3.8'

services:
  sfdrn-node:
    build:
      context: .
      dockerfile: Dockerfile
    image: sfdrn:latest
    container_name: sfdrn-${NODE_NAME:-node}
    environment:
      # Optional: Override auto-detected values
      - NODE_ID=${NODE_ID}
      - REGION=${REGION}
      - PUBLIC_ENDPOINT=${PUBLIC_ENDPOINT}
      - ASPNETCORE_URLS=http://0.0.0.0:5000
      
      # Required for non-pioneer nodes: comma-separated list of bootstrap nodes
      # Example: BOOTSTRAP_NODES=http://1.2.3.4:5000,http://5.6.7.8:5000
      - BOOTSTRAP_NODES=${BOOTSTRAP_NODES}
    ports:
      - "${PORT:-5000}:5000"
    restart: unless-stopped
    networks:
      - sfdrn-net
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

networks:
  sfdrn-net:
    driver: bridge